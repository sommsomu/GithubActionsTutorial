# This workflow demonstrates the use of various types of variables in GitHub Actions, including environment variables, secrets, and inputs.
name: GitHub Actions - All Variables Demo

on:
  workflow_dispatch:
    inputs:
      environment:
        description: "Deployment environment"
        required: true
        default: "dev"
      version:
        description: "Application version"
        required: false
        default: "1.0.0"

# -------------------------
# ENV VARIABLES (Workflow level)
# -------------------------
env:
  GLOBAL_ENV: "global-env-value"

jobs:
  build:
    runs-on: ubuntu-latest

    # -------------------------
    # JOB OUTPUTS
    # -------------------------
    outputs:
      build_tag: ${{ steps.set_output.outputs.build_tag }}

    # -------------------------
    # MATRIX VARIABLES
    # -------------------------
    strategy:
      matrix:
        node: [18, 20]

    # -------------------------
    # ENV VARIABLES (Job level)
    # -------------------------
    env:
      JOB_ENV: "job-env-value"

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      # -------------------------
      # GITHUB CONTEXT VARIABLES
      # -------------------------
      - name: GitHub context variables
        run: |
          echo "Repository      : ${{ github.repository }}"
          echo "Actor           : ${{ github.actor }}"
          echo "Branch          : ${{ github.ref_name }}"
          echo "Commit SHA      : ${{ github.sha }}"
          echo "Workflow name   : ${{ github.workflow }}"
          echo "Run number      : ${{ github.run_number }}"

      # -------------------------
      # ENV VARIABLES (Step level)
      # -------------------------
      - name: Environment variables demo
        env:
          STEP_ENV: "step-env-value"
        run: |
          echo "GLOBAL_ENV = $GLOBAL_ENV"
          echo "JOB_ENV    = $JOB_ENV"
          echo "STEP_ENV   = $STEP_ENV"

      # -------------------------
      # INPUT VARIABLES
      # -------------------------
      - name: Workflow inputs demo
        run: |
          echo "Environment input : ${{ inputs.environment }}"
          echo "Version input     : ${{ inputs.version }}"

      # -------------------------
      # MATRIX VARIABLE
      # -------------------------
      - name: Matrix variable demo
        run: |
          echo "Matrix Node Version: ${{ matrix.node }}"

      # -------------------------
      # REPOSITORY VARIABLES (vars)
      # -------------------------
      - name: Repository variables demo
        run: |
          echo "APP_NAME        : ${{ vars.APP_NAME }}"
          echo "DEPLOY_REGION   : ${{ vars.DEPLOY_REGION }}"

      # -------------------------
      # SECRET VARIABLES
      # -------------------------
      - name: Secrets demo (masked)
        env:
          DEMO_SECRET: ${{ secrets.DEMO_SECRET }}
        run: |
          echo "Secret length is: ${#DEMO_SECRET}"

      # -------------------------
      # STEP OUTPUT
      # -------------------------
      - name: Set step output
        id: set_output
        run: |
          TAG="${{ inputs.version }}-${{ github.run_number }}"
          echo "build_tag=$TAG" >> $GITHUB_OUTPUT

  deploy:
    runs-on: ubuntu-latest
    needs: build

    steps:
      # -------------------------
      # NEEDS (Job Output)
      # -------------------------
      - name: Job output from build
        run: |
          echo "Build tag received:"
          echo "${{ needs.build.outputs.build_tag }}"

      # -------------------------
      # RUNNER CONTEXT
      # -------------------------
      - name: Runner context demo
        run: |
          echo "Runner OS   : ${{ runner.os }}"
          echo "Runner Arch : ${{ runner.arch }}"

      # -------------------------
      # JOB CONTEXT
      # -------------------------
      - name: Job context demo
        run: |
          echo "Job status: ${{ job.status }}"